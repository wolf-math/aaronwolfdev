"use strict";(globalThis.webpackChunkaaronwolf_dev=globalThis.webpackChunkaaronwolf_dev||[]).push([[904],{8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>c});var s=r(6540);const t={},o=s.createContext(t);function a(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},8664:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"coding/python/user_guide/functions/decorators","title":"Decorators","description":"What are decorators?","source":"@site/docs/coding/python/user_guide/functions/decorators.md","sourceDirName":"coding/python/user_guide/functions","slug":"/coding/python/user_guide/functions/decorators","permalink":"/docs/coding/python/user_guide/functions/decorators","draft":false,"unlisted":false,"editUrl":"https://github.com/wolf-math/aaronwolfdev/tree/main/docs/coding/python/user_guide/functions/decorators.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Decorators","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Lambda functions","permalink":"/docs/coding/python/user_guide/functions/lambda"},"next":{"title":"Higher-order functions","permalink":"/docs/coding/python/user_guide/functions/higher_order_functions"}}');var t=r(4848),o=r(8453);const a={title:"Decorators",sidebar_position:4},c=void 0,i={},l=[{value:"What are decorators?",id:"what-are-decorators",level:2},{value:"Why this matters",id:"why-this-matters",level:2},{value:"A simple decorator",id:"a-simple-decorator",level:2},{value:"Decorators and <code>*args</code>, <code>**kwargs</code>",id:"decorators-and-args-kwargs",level:2},{value:"Preserving metadata with <code>functools.wraps</code>",id:"preserving-metadata-with-functoolswraps",level:2},{value:"Decorators with arguments",id:"decorators-with-arguments",level:2},{value:"Common real-world patterns",id:"common-real-world-patterns",level:2},{value:"Timing a function",id:"timing-a-function",level:3},{value:"Simple access control (role check)",id:"simple-access-control-role-check",level:3},{value:"Caching results",id:"caching-results",level:3},{value:"Decorating methods",id:"decorating-methods",level:2},{value:"Built-in decorators",id:"built-in-decorators",level:2},{value:"When (and when not) to use decorators",id:"when-and-when-not-to-use-decorators",level:2}];function d(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"what-are-decorators",children:"What are decorators?"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.strong,{children:"decorator"})," is a function that wraps another function to add or modify behavior\u2014",(0,t.jsx)(n.em,{children:"without"})," changing the wrapped function\u2019s code. In Python syntax, decorators are written with the ",(0,t.jsx)(n.code,{children:"@decorator_name"})," line above a function definition."]}),"\n",(0,t.jsx)(n.p,{children:"Under the hood, this:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"@decorator\ndef func():\n    ...\n"})}),"\n",(0,t.jsx)(n.p,{children:"is equivalent to:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"def func():\n    ...\n\nfunc = decorator(func)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Decorators are a practical application of ",(0,t.jsx)(n.strong,{children:"higher-order functions"}),": they take a function as input and return a new function."]}),"\n",(0,t.jsx)(n.h2,{id:"why-this-matters",children:"Why this matters"}),"\n",(0,t.jsx)(n.p,{children:"Decorators let you:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Reuse cross-cutting behavior"})," like logging, timing, caching, and access control."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keep business logic clean"})," by moving boilerplate out of your core functions."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Compose behavior"})," by stacking multiple decorators."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"They show up everywhere in real-world Python:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@classmethod"}),", ",(0,t.jsx)(n.code,{children:"@staticmethod"}),", ",(0,t.jsx)(n.code,{children:"@property"})," in classes"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:'@app.route("/path")'})," in web frameworks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@pytest.mark.parametrize"})," in tests"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Understanding decorators is essential for reading and writing modern Python."}),"\n",(0,t.jsx)(n.h2,{id:"a-simple-decorator",children:"A simple decorator"}),"\n",(0,t.jsx)(n.p,{children:"Let\u2019s start with a minimal decorator that prints before and after a function call."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'def debug(func):\n    """Print the function name and arguments each time it\'s called."""\n\n    def wrapper(*args, **kwargs):\n        print(f"Calling {func.__name__} with args={args}, kwargs={kwargs}")\n        result = func(*args, **kwargs)\n        print(f"{func.__name__} returned {result}")\n        return result\n\n    return wrapper\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Use it with ",(0,t.jsx)(n.code,{children:"@debug"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"@debug\ndef add(a, b):\n    return a + b\n\nadd(2, 3)\n# Calling add with args=(2, 3), kwargs={}\n# add returned 5\n"})}),"\n",(0,t.jsx)(n.p,{children:"Here:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"debug"})," takes ",(0,t.jsx)(n.code,{children:"func"})," as an argument."]}),"\n",(0,t.jsxs)(n.li,{children:["It defines ",(0,t.jsx)(n.code,{children:"wrapper"}),", which calls ",(0,t.jsx)(n.code,{children:"func"})," and adds extra behavior."]}),"\n",(0,t.jsxs)(n.li,{children:["It returns ",(0,t.jsx)(n.code,{children:"wrapper"}),", which becomes the new version of ",(0,t.jsx)(n.code,{children:"add"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.h2,{id:"decorators-and-args-kwargs",children:["Decorators and ",(0,t.jsx)(n.code,{children:"*args"}),", ",(0,t.jsx)(n.code,{children:"**kwargs"})]}),"\n",(0,t.jsxs)(n.p,{children:["Real-world decorators should work with ",(0,t.jsx)(n.strong,{children:"any"})," function signature. That\u2019s why decorators almost always use ",(0,t.jsx)(n.code,{children:"*args"})," and ",(0,t.jsx)(n.code,{children:"**kwargs"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'def log_calls(func):\n    def wrapper(*args, **kwargs):\n        print(f"\u2192 {func.__name__} called")\n        result = func(*args, **kwargs)\n        print(f"\u2190 {func.__name__} finished")\n        return result\n    return wrapper\n'})}),"\n",(0,t.jsx)(n.p,{children:"This decorator can wrap functions with any parameters:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'@log_calls\ndef greet(name, punctuation="!"):\n    print(f"Hello, {name}{punctuation}")\n\ngreet("Alice")\ngreet("Bob", punctuation="!!!")\n'})}),"\n",(0,t.jsxs)(n.h2,{id:"preserving-metadata-with-functoolswraps",children:["Preserving metadata with ",(0,t.jsx)(n.code,{children:"functools.wraps"})]}),"\n",(0,t.jsx)(n.p,{children:"By default, the wrapper function hides the original function\u2019s name and docstring:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'@debug\ndef multiply(a, b):\n    """Multiply two numbers."""\n    return a * b\n\nprint(multiply.__name__)  # \'wrapper\', not \'multiply\'\nprint(multiply.__doc__)   # None\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Use ",(0,t.jsx)(n.a,{href:"https://docs.python.org/3/library/functools.html#functools.wraps",children:(0,t.jsx)(n.code,{children:"functools.wraps"})})," to copy metadata from the original function to the wrapper:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import functools\n\ndef debug(func):\n    @functools.wraps(func)\n    def wrapper(*args, **kwargs):\n        print(f"Calling {func.__name__} with args={args}, kwargs={kwargs}")\n        result = func(*args, **kwargs)\n        print(f"{func.__name__} returned {result}")\n        return result\n    return wrapper\n'})}),"\n",(0,t.jsx)(n.p,{children:"Now:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'@debug\ndef multiply(a, b):\n    """Multiply two numbers."""\n    return a * b\n\nprint(multiply.__name__)  # \'multiply\'\nprint(multiply.__doc__)   # \'Multiply two numbers.\'\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Always use ",(0,t.jsx)(n.code,{children:"@functools.wraps"})," in real decorators unless you have a very specific reason not to."]}),"\n",(0,t.jsx)(n.h2,{id:"decorators-with-arguments",children:"Decorators with arguments"}),"\n",(0,t.jsxs)(n.p,{children:["Sometimes you want to configure a decorator, e.g., set a logging level or a label. This means ",(0,t.jsx)(n.strong,{children:"the decorator itself needs parameters"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Pattern:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Outer function: takes decorator arguments, returns the real decorator."}),"\n",(0,t.jsx)(n.li,{children:"Decorator: takes the function and returns a wrapper."}),"\n",(0,t.jsx)(n.li,{children:"Wrapper: wraps the function call."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import functools\n\ndef repeat(times):\n    """Decorator factory to repeat a function call."""\n\n    def decorator(func):\n        @functools.wraps(func)\n        def wrapper(*args, **kwargs):\n            result = None\n            for _ in range(times):\n                result = func(*args, **kwargs)\n            return result\n        return wrapper\n\n    return decorator\n'})}),"\n",(0,t.jsx)(n.p,{children:"Usage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'@repeat(3)\ndef say(message):\n    print(message)\n\nsay("Hello")\n# Hello\n# Hello\n# Hello\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here, ",(0,t.jsx)(n.code,{children:"repeat(3)"})," returns a decorator, which then wraps ",(0,t.jsx)(n.code,{children:"say"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"common-real-world-patterns",children:"Common real-world patterns"}),"\n",(0,t.jsx)(n.h3,{id:"timing-a-function",children:"Timing a function"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import functools\nimport time\n\ndef timing(func):\n    @functools.wraps(func)\n    def wrapper(*args, **kwargs):\n        start = time.perf_counter()\n        result = func(*args, **kwargs)\n        end = time.perf_counter()\n        print(f"{func.__name__} took {end - start:.4f} seconds")\n        return result\n    return wrapper\n'})}),"\n",(0,t.jsx)(n.h3,{id:"simple-access-control-role-check",children:"Simple access control (role check)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import functools\n\ndef require_role(role):\n    def decorator(func):\n        @functools.wraps(func)\n        def wrapper(user, *args, **kwargs):\n            if role not in user.get("roles", []):\n                raise PermissionError(f"User lacks role: {role}")\n            return func(user, *args, **kwargs)\n        return wrapper\n    return decorator\n\n@require_role("admin")\ndef delete_user(user, target_id):\n    print(f"User {target_id} deleted")\n'})}),"\n",(0,t.jsx)(n.h3,{id:"caching-results",children:"Caching results"}),"\n",(0,t.jsxs)(n.p,{children:["You can write your own caching decorator, but Python also provides ",(0,t.jsx)(n.a,{href:"https://docs.python.org/3/library/functools.html#functools.lru_cache",children:(0,t.jsx)(n.code,{children:"functools.lru_cache"})}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:"import functools\n\n@functools.lru_cache(maxsize=128)\ndef fibonacci(n):\n    if n < 2:\n        return n\n    return fibonacci(n-1) + fibonacci(n-2)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"decorating-methods",children:"Decorating methods"}),"\n",(0,t.jsxs)(n.p,{children:["Decorators work the same way on functions and methods. When you decorate a method inside a class, the wrapper still receives ",(0,t.jsx)(n.code,{children:"self"})," as the first argument:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import functools\n\ndef log_method(func):\n    @functools.wraps(func)\n    def wrapper(self, *args, **kwargs):\n        print(f"{self.__class__.__name__}.{func.__name__} called")\n        return func(self, *args, **kwargs)\n    return wrapper\n\nclass Greeter:\n    @log_method\n    def greet(self, name):\n        return f"Hello, {name}!"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"built-in-decorators",children:"Built-in decorators"}),"\n",(0,t.jsx)(n.p,{children:"Python includes several decorators you\u2019ll see frequently:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@property"})," \u2014 turn a method into a managed attribute"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@staticmethod"})," \u2014 define a function stored on a class that doesn\u2019t get ",(0,t.jsx)(n.code,{children:"self"})," or ",(0,t.jsx)(n.code,{children:"cls"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"@classmethod"})," \u2014 method that receives the class (",(0,t.jsx)(n.code,{children:"cls"}),") instead of the instance"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'class Circle:\n    def __init__(self, radius):\n        self._radius = radius\n\n    @property\n    def radius(self):\n        return self._radius\n\n    @radius.setter\n    def radius(self, value):\n        if value < 0:\n            raise ValueError("radius must be non-negative")\n        self._radius = value\n'})}),"\n",(0,t.jsx)(n.h2,{id:"when-and-when-not-to-use-decorators",children:"When (and when not) to use decorators"}),"\n",(0,t.jsx)(n.p,{children:"Decorators are a good choice when:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["You see the ",(0,t.jsx)(n.strong,{children:"same pattern"})," repeated across many functions."]}),"\n",(0,t.jsxs)(n.li,{children:["You want to ",(0,t.jsx)(n.strong,{children:"separate concerns"})," (e.g., logging vs. business logic)."]}),"\n",(0,t.jsxs)(n.li,{children:["You need ",(0,t.jsx)(n.strong,{children:"reusable wrappers"})," that can be applied with one line."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"They can be overkill when:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The behavior is used only once."}),"\n",(0,t.jsx)(n.li,{children:"The decorator logic is more complicated than the function it wraps."}),"\n",(0,t.jsx)(n.li,{children:"It makes the control flow harder to follow for your future self."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"When in doubt, start with a normal helper function. If you notice a pattern repeating, refactor it into a decorator."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);